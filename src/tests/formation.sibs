@import(./common.sibs);
@import(./defaults.sibs);
#(app: ./app)
    /// Application 
    @hash 
        (("./src"; "./dist"; :client; :shared; :wrapper);
        (:build("dev")));
    build($mode: dev | prod) [
        /// Building electron application 
        /// build dev >> build developing version
        /// build prod >> build production version
        $dev = @envvar(DEV_MODE);
        @cd(./some_folder);
        // Comment
        // Comment long comment  long comment  long comment  long comment  long comment  long comment long comment  long comment  long comment  long comment 
        @cd(..);
        @remove(./node_modules/shared);
        @remove(./node_modules/wrapper);
        @remove(./dist/client);
        :shared:prod;
        @copy(../shared; ./node_modules);
        :wrapper:prod;
        @copy(../core/wrapper; ./node_modules);
        $mode == "dev" => :client:build("dev");
        $mode == "prod" => :client:build("prod");
        // Comment
        // Comment 1long comment  2long comment  3long comment  4long comment  5long comment  6long comment 7long comment  8long comment  9long comment  10long comment 11long comment  12long comment  13long comment  14long comment  15long comment  16long comment 17long comment  18long comment  19long comment  20long comment
        @copy(../client/dist/client; ./dist);
        `yarn run build`;
        @copy(./package.json; ./dist);
    ];
    release($mode: dev | prod) [
        /// Build release artifacts
        /// release dev >> build developing version
        /// release prod >> build production version
        :self:build($mode);
        @os(window) => `yarn run build-win`;
        @os(linux) => `yarn run build-linux`;
        @os(darwin) => `yarn run build-darwin`;
        IF @os(linux) ["release{$version}-linux.zip";] IF @os(darwin) ["release{$version}-mac.zip";] IF @os(windows) ["release{$version}-win.zip";] ELSE [@exit(1; "Unsupported OS: {@os}");];
        IF @os(linux) || @os(darwin) ["release{$version}-normal_os.zip";] ELSE ["release{$version}-windows.zip";];
        IF @os(linux) [@cd(./linux);] IF @os(darwin) [@cd(./mac);] IF @os(windows) [@cd(./windows);] ELSE [@exit(1; "Unsupported OS: {@os}");];
        IF $variable == "one" [@cd(./linux);] IF $variable == "two" [@cd(./mac);] IF $variable == "three" [@cd(./windows);] ELSE [@exit(1; "Unsupported OS: {@os}");];
        IF (@user_active("user_id") && $last_login < @now) || (@user_subscription("user_id") == "expired" && $email_sent == false) [@cd(./linux);] IF (@user_active("user_id") && $last_login < @now) || (@user_subscription("user_id") == "expired" && $email_sent == false) [@cd(./mac);] IF (@user_active("user_id") && $last_login < @now) || (@user_subscription("user_id") == "expired" && $email_sent == false) [@cd(./windows);] ELSE [@exit(1; "Unsupported OS: {@os}");];
    ];
    optional [
        @os(darwin) => "release{$version}-darwin.zip";
        @os(window) => [@cd(something1);@sh("zip ./release/unpacked-win {$file_name}");@cd(..);];
        $mode != "dev" => [@cd(something2);@sh("zip ./release/unpacked-win {$file_name}");@cd(..);];
        @os(something) => $file_name = FIRST [@os(window) => "release{$version}-win.zip";@os(linux) => "release{$version}-linux.zip";@os(darwin) => "release{$version}-darwin.zip";@exit(1; "Unsupported OS: {@os}");];
        @check_env("production") => $deploy = true;
        $is_logged_in => @logout_user;
        $system == "windows" => `shutdown /s`;
        $disk_space < 10 => @notify_admin("Low disk space");
        @user_role($user_id) == "admin" => @grant_access;
        $age > 18 => "Access granted";
        $temperature > 30 => @activate_cooling_system;
        $status != "active" => @suspend_account($user_id);
        @is_weekday => $discount_rate = 0;
        $is_raining => @cancel_event("Outdoor Gala");
        @time_check("22:00") => `night_mode_activate`;
    ];
    functions [
        @read_as_string(./package.json) >> @find(/\"version\":\ \"([\d\.])\"/gi);
        @read_as_string(./package.json) >> @find(/\"version\":\ \"([\d\.])\"/gi) >> @filter(123);
        @import($variable);
        @import($a; $b);
        @import($a; $b);
        @import;
        @import;
        @import(./tasks.sibs; $variable);
        @import($variable; ./tasks.sibs; $variable; $variable; ./tasks.sibs; $variable; $variable; ./tasks.sibs; $variable; $variable; ./tasks.sibs; $variable);
        @copy("filename-{$platform}.zip"; ./node_modules; $dest);
        @hash(("./src"; "./dist"; :client; :shared; :wrapper); (:build("dev")));
        @hash(("./path"; "./path/to"; "./path with spaces"; :componentA; :componentB; "./path"; "./path/to"; "./path"; "./path/to"; "./path with spaces"; :componentA; :componentB; "./path with spaces"; :componentA; :componentB; :componentC); (:build("dev")));
        @cd(something1);
        @calculate_sum("5"; "10");
        ("./path"; "./path/to"; "./path with spaces"; :componentA; :componentB; "./path"; "./path/to"; "./path"; "./path/to"; "./path with spaces"; :componentA; :componentB; "./path with spaces"; :componentA; :componentB; :componentC);
        (:componentB; "./path"; "./path/to"; "./path"; "./path/to"; "./path with spaces"; :componentA; :componentB; "./path with spaces"; :componentA; :componentB; :componentC);
        ("./path/to"; "./path with spaces"; :componentA; :componentB; "./path with spaces"; :componentA; :componentB; :componentC);
        ("./path/to"; "./path with spaces"; :componentA; :componentB; :componentC);
    ];
    commands [
        `run-script --file="/scripts/{$script_name}.sh" --args="{@concat($arg1; $arg2; $arg3)}"`;
        `fetch-data --query="{@encode_url("SELECT * FROM users WHERE status = 'active'")}" --database-url={$database_url}`;
        `compile-code --source="{$project_dir}/src" --target="{$project_dir}/build" --flags="{@join($flag1; $flag2; "--optimize")}"`;
        `transform-data --input="{$data_file}" --transformation="/transformations/{$transformation_id}.py" --params="{@serialize($param1; $param2; $param3)}"`;
        `send-request --url="{$api_endpoint}" --headers="Authorization: Bearer {@get_token($api_key)}" --body="{@json_encode($request_body)}"`;
        `plot-graph --data-file="{$data_file}" --output="{$output_dir}/graph_{@timestamp}.png" --title="{$graph_title}" --type="{@select_graph_type($graph_type)}"`;
        `batch-process --job="{$job_name}" --input-dir="/input/{$batch_id}" --output-dir="/output/{$batch_id}" --config="{@load_config($job_config_file)}"`;
        `schedule-meeting --participants="{@list_to_csv($participants)}" --datetime="{@format_datetime($meeting_date; $meeting_time)}" --agenda="{$agenda}" --location="{IF $virtual == "true" ["Zoom";] ELSE [$meeting_room;]}"`;
    ];
    ifs [
        IF (@functionH("arg8") == $var3 && $var4 != "mismatch") || (@functionH("arg8") == $var3 && $var4 != "mismatch") ["Condition met";];
        IF (@check_access("user_id") == true && $status != "restricted") || (@get_role("user_id") == "admin" && $status == "active") ["Access granted";];
        IF (@calculate_sum(5; 10) > 10 && $number != 0) || (@calculate_difference(10; 5) < 10 && $number == 5) ["Calculation correct";];
        IF (@is_weekday && $hour >= 9 && $hour < 17) || (@is_holiday && $hour >= 10 && $hour < 15) ["Work hours";];
        IF (@get_temperature("city") > 30 && $is_ac_on == false) || (@get_humidity("city") > 70 && $is_dehumidifier_on == false) ["Adjust climate control";];
        IF (@user_active("user_id") && $last_login < @now) || (@user_subscription("user_id") == "expired" && $email_sent == false) ["User checkup";];
        IF (@item_in_stock("item_id") && $cart_count < 5) || (@promotion_active("promo_code") && $discount_applied == false) ["Shopping conditions";];
        IF (@score("user_id") > 1000 && $badge_awarded == false) || (@achievements_count("user_id") >= 10 && $special_reward == false) ["Reward conditions";];
        IF (@distance_to_destination("location") < 5 && $fuel_level > 10) || (@traffic_condition("route") == "clear" && $departure_time <= @now) ["Travel readiness";];
        IF (@is_password_strong($password) && $password_changed_recently == false) || (@has_two_factor_auth("user_id") == false && $account_security_level < 3) ["Security checks";];
        IF (@file_exists("path/to/document") && $document_open == false) || (@is_network_connected && $sync_pending == true) ["File and network conditions";];
        EACH($file; $files) [
            `tgz ./release/{$file}`;
            IF (@functionH("arg8") == $var3 && $var4 != "mismatch") || (@functionH("arg8") == $var3 && $var4 != "mismatch") ["Condition met";];
            IF (@check_access("user_id") == true && $status != "restricted") || (@get_role("user_id") == "admin" && $status == "active") ["Access granted";];
            IF (@calculate_sum(5; 10) > 10 && $number != 0) || (@calculate_difference(10; 5) < 10 && $number == 5) ["Calculation correct";];
            IF (@is_weekday && $hour >= 9 && $hour < 17) || (@is_holiday && $hour >= 10 && $hour < 15) ["Work hours";];
            IF (@get_temperature("city") > 30 && $is_ac_on == false) || (@get_humidity("city") > 70 && $is_dehumidifier_on == false) ["Adjust climate control";];
            IF (@user_active("user_id") && $last_login < @now) || (@user_subscription("user_id") == "expired" && $email_sent == false) ["User checkup";];
            IF (@item_in_stock("item_id") && $cart_count < 5) || (@promotion_active("promo_code") && $discount_applied == false) ["Shopping conditions";];
            IF (@score("user_id") > 1000 && $badge_awarded == false) || (@achievements_count("user_id") >= 10 && $special_reward == false) ["Reward conditions";];
            IF (@distance_to_destination("location") < 5 && $fuel_level > 10) || (@traffic_condition("route") == "clear" && $departure_time <= @now) ["Travel readiness";];
            IF (@is_password_strong($password) && $password_changed_recently == false) || (@has_two_factor_auth("user_id") == false && $account_security_level < 3) ["Security checks";];
            IF (@file_exists("path/to/document") && $document_open == false) || (@is_network_connected && $sync_pending == true) ["File and network conditions";];

            IF (@file1_exists("path/to/document") && $document_open == false  && $document_open == false  && $document_open == false  && $document_open == false  && $document_open == false) || (@is_network_connected && $sync_pending == true) ["File and network conditions";];
            IF (@file2_exists("path/to/document") && $document_open == false) || (@is_network_connected && $sync_pending == true && $document_open == false  && $document_open == false  && $document_open == false  && $document_open == false  && $document_open == false) ["File and network conditions";];
        ];
    ];
    pattern_strings [
        "Meeting reminder: {
            @get_meeting_title($meeting_id)
        } with {
            @get_participant_names($meeting_id)
        } on {
            @format_datetime(@get_meeting_time($meeting_id))
        }.";
        "Service {@get_service_name($service_id)} is currently {@if(@service_status($service_id); 'operational'; 'experiencing issues')}.";
        "Your current location: {@get_location_name($location_id)}, with weather conditions: {@get_weather($location_id)}.";
        "Upcoming event: {@get_event_name($event_id)} on {@format_date(@get_event_date($event_id))} at {@get_event_location($event_id)}.";
        "Quote of the day: {@get_quote(@get_random_author)} - {@get_author_name(@get_random_author)}.";
    ];
